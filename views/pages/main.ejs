<!-- views/main.ejs -->
<!doctype html>
<html lang="fr">
<head>
    <% include ../partials/head %>
</head>
<body>

   <% include ../partials/navbar %>

<div class="container hero-unit" id="mainAction">

            <div class="row-fluid">
                <div class="span12">
                    <% if(messagesuccessmain.length > 0 ) { %>
                        <div class="alert alert-success" id="messagesuccessmain">
                            <%= messagesuccessmain %>
                        </div>
                    <%
                    }
                    %>

                    <% if(messagedangermain.length > 0 ) { %>
                        <div class="alert alert-danger" id="messagedangermain">
                            <%= messagedangermain %>
                        </div>
                    <%
                    }
                    %>

                    <h2 class="text-center">Petit Emprunt :</h2>
                </div>
            </div>

            <div class="row-fluid">
                <div class="span4 offset4 text-center">
                    <hr>
                    <form id="mainform" action="/newloan" method="post">
                        <fieldset>
                        <% if(messagedangerwhat.length > 0 ) { %>
                            <div class="alert alert-danger" id="dangerWhat">
                            <%= messagedangerwhat %>
                            </div>
                            <%
                            }
                            %>
                        <input type="text" placeholder="Quoi ?" id="fieldWhat" name="what" <% if(what.length > 0) { %>
                        value=<%= what %>
                        <% } %>
                        >
                            
                            <% if(messagedangerwhom.length > 0) { %>
                            <div class="alert alert-danger" id="dangerWho">
                            <%= messagedangerwhom %>
                            </div>
                            <%
                            }
                            %>
                        <input type="text" placeholder="A Qui ? - mail" id="fieldWho" name="whom" <% if(whom.length > 0) { %>
                        value=<%= whom %>
                        <% } %>
                        >
                            <% if(messagedangerwhen.length > 0) { %>
                            <div class="alert alert-danger" id="dangerWhen">
                            <%= messagedangerwhen %>
                            </div>
                            <%
                            }
                            %>
                        <input type="text" placeholder="Quand ?" id="fieldWhen" name="when" <% if(when.length > 0) { %>
                        value=<%= when %>
                        <% } %>
                        >
                            
                        </fieldset>
                        <button id="submitIBorrowButton" class="btn btn-info"><big>J'emprunte</big></button>

                        <button id="submitILoanButton" class="btn btn-info"><big>Je prête</big></button>
                    </form>
                </div>
            </div>

</div>

<div class="container hero-unit">
            <div class="row-fluid" id="activity">

                <div class="span2">
                    <h4 class="text-left">Mes amis</h4>
                    <ul id="friends" class="unstyled">
                        <!-- should be dynamical and not by ejs-->
                        <% if(friendList.size > 0) { %>
                        <li><a href="/main">Tous</a></li>
                            <% for( friend of friendList) {%>
                                <li><a href="?friend=<%= friend %>"><%= friend %></a></li>
                            <% } %>
                        <% } %>
                    </ul>
                </div>

                <div class="span8">
                    <h3 class="text-left">Mes Emprunts : <small>
                    <%if (reqfriend=="none") 
                    {
                    %>
                        (<%= myborrows.length %> en cours ) </small>
                        </h3>                        
                    <%}
                    else
                    {
                        %>
                        (<%= myborrows.length %> en cours avec <%=reqfriend%> )</small>
                        </h3>
                        <%
                    }%>

                    <table id="lendingsIBorrow" class="table table-striped">
                        <tbody id="lendingsIBorrowBody">
                        <!-- should be dynamical and not by ejs-->
                        <% for( i = 0; i < myborrows.length ; i+=1) { %>
                            <tr id="loan<%= myborrows[i]._id %>">
                                <td><%= myborrows[i].what %> <small>emprunté à <%= myborrows[i].loaner %> le <%=myborrows[i].when%></small></td>
                                <td><small><%= myborrows[i].getDelay() %></small></td>
                                <td><button class="btn btnpoke" id="poke<%= myborrows[i]._id %>" onclick="location.href='/remind/<%=myborrows[i]._id%>'" title="envoyer un mail de relance">Relancer</button></td>
                                <td><button class="btn btn-danger btndelete" id="deleteloan<%= myborrows[i]._id %>" title="supprimer l'emprunt"><i class="icon-remove icon-white"></i></button></td>
                            </tr>
                        <% } %>
                        </tbody>
                    </table>

                    <hr>

                    <h3 class="text-left">Mes Prêts : <small>
                    <%if (reqfriend=="none") 
                    {
                    %>
                        (<%= myloans.length %> en cours )</small>
                        </h3>                        
                    <%}
                    else
                    {
                        %>
                        (<%= myloans.length %> en cours avec <%=reqfriend%> )</small>
                        </h3>
                        <%
                    }%>
                    <table id="lendingsILoan" class="table table-striped">
                        <tbody id="lendingsILoanBody">
                        <!-- should be dynamical and not by ejs-->
                        <% for( i = 0; i < myloans.length ; i+=1) { %>
                            <tr id="loan<%= myloans[i]._id %>">
                                <td><%= myloans[i].what %> <small>prêté à <%= myloans[i].borrower %> le <%=myloans[i].when%></small></td>
                                <td><small><%= myloans[i].getDelay() %></small></td>
                                <td><button class="btn btnpoke" id="poke<%= myloans[i]._id %>" onclick="location.href='/remind/<%=myloans[i]._id%>'" title="envoyer un mail de relance">Relancer</button></td>
                                <td><button class="btn btn-danger btndelete" id="deleteloan<%= myloans[i]._id %>" title="supprimer l'emprunt"><i class="icon-remove icon-white"></i></button></td>
                            </tr>
                        <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
            
    </div>

<footer>
    <% include ../partials/footer %>
</footer>

    <% include ../partials/scripts %>

<!-- pickaday -->
        <script src="/moment.js"></script>
        <script src="/pikaday.js"></script>
        <script>
            moment.locale("fr")
            //var picker = new Pikaday({ field: document.getElementById('fieldWhen') })
             var picker = new Pikaday({
                field: document.getElementById('fieldWhen'),
                format: 'D MMM YYYY',
                i18n: {
                    previousMonth : 'Mois précédent',
                    nextMonth     : 'Mois suivant',
                    months        : ['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'],
                    weekdays      : ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
                    weekdaysShort : ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam']
                    }
                })
        </script>
        <script src="/main.js"></script>

</body>
</html>
<html lang="fr">
	<head>
	  <meta charset="utf-8">
		<title>Liste des Emprunts entre amis</title>
		<meta descr="Suivez vos emprunts entre amis.">
		<script type="text/javascript" src="world.js"></script>
		<script type="text/javascript" src="init.js"></script>
	</head>
	<body>
		<h1>Ajouter un emprunt</h1>
			<table>
				<tr>
					<td>Quoi ?</td> <td><input type='text' id="fieldWhat"></td>
				</tr>
				<tr>
					<td>Par Qui ?</td> <td><input type='text' id="fieldWho"></td>
				</tr>
				<tr>
					<td>Quand ?</td> <td><input type='text' id="fieldWhen"></td>
				</tr>
				<tr>
					<td><button type="button" onclick="submitNewLending()">Nouvel Emprunt</button></td>
				</tr>
			</table>
		<ul>
			<li><a href="index.html">Tous</a></li>
			<script type="text/javascript">
			const world = new World()
			const friends = world.findFriends()
			friends.forEach(friend => {
			 document.write(
				`<li>
					<a href="?friendName=${friend}">${friend}</a>
				</li>`
				)
				})
			</script>
		</ul>
		<h1>Liste des Emprunts</h1>
		<ul>
			<script type="text/javascript">
				const query = document.location.search.split('?friendName=')[1]
				//const world = new World()
				//way to add remove button seems to be dirty to me ... shouldn't I use the dom and addElement ?
				world.findLendings(query).map(lending => document.write(
					`<li>
						${lending.name} emprunt√© par ${lending.friend} depuis le ${lending.date} <button type="button" onclick="remove('${lending.name}')">Remove</button>
					 </li>`
				))
				const submitNewLending = () => {
					const who = document.querySelector("#fieldWho").value ;
					const when = document.querySelector("#fieldWhen").value
					const what = document.querySelector("#fieldWhat").value
					const lending = {name: what, date : when, friend: who}
					//It works but you need to refresh the page.
					//should be an http request and an auto refresh through callback of list of lendings
					world.new(lending)
				}
				const remove = (name) => {
					//It works but you need to refresh the page.
					//should be an http request and an auto refresh through callback of list of lendings
					world.remove(name)
				}

			</script>
		</ul>
	</body>
</html>
